"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1124],{34637:function(e,r,t){t.d(r,{Y:function(){return d},Z:function(){return p}});var n=t(59499),a=t(81719),o=t(87054),s=(t(67294),t(85893));function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var c=(0,a.ZP)(o.Z)((function(e){var r=e.theme;return{border:"0px",flex:1,backgroundColor:"#383D51",borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",".MuiTypography-subheader1":{background:r.palette.gradients.aaveGradient,backgroundClip:"text",textFillColor:"transparent"},".MuiTypography-secondary14":{background:r.palette.gradients.aaveGradient,backgroundClip:"text",textFillColor:"transparent"}}}})),l=(0,a.ZP)(o.Z)((function(e){var r=e.theme;return{border:"0px",flex:1,color:r.palette.text.muted,borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{border:"1px solid ".concat(r.palette.other.standardInputLine),backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",color:r.palette.background.header}}}));function d(e){return(0,s.jsx)(l,u({},e))}function p(e){return(0,s.jsx)(c,u({},e))}},59379:function(e,r,t){t.d(r,{f:function(){return d},Z:function(){return p}});var n=t(59499),a=t(81719),o=t(85390),s=t(85893);function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var c=(0,a.ZP)(o.Z)({backgroundColor:"#383D51",border:"1px solid rgba(235, 235, 237, 0.12)",padding:"4px"}),l=(0,a.ZP)(o.Z)((function(e){return{backgroundColor:e.theme.palette.background.header,padding:"2px",height:"36px",width:"100%"}}));function d(e){return(0,s.jsx)(l,u({},e))}function p(e){return(0,s.jsx)(c,u({},e))}},91124:function(e,r,t){t.r(r),t.d(r,{WithdrawModal:function(){return We}});var n=t(59499),a=t(49501),o=t(67294),s=t(47130),i=t(73965),u=t(8195),c=t(46930),l=t(69125),d=t(63206),p=t(31959),m=t(94635),f=t(90116),h=t(1279),v=t(55929),y=t(30120),x=t(81645),g=t(29630),b=t(9144),A=t(75158),T=t(25935),w=t(41024),O=t(72667),S=t(69331),k=t(74119),j=t(30313),I=t(39051),C=t(71691),E=t(77537),R=t(20301),W=t(78371),D=t(68448),_=t(57609),P=t(87385),M=t(53601),N=t(67916),H=t(57824),L=t(94671),B=t(70794),U=function(e,r,t){var n=(0,h.hE)((null===r||void 0===r?void 0:r.underlyingBalance)||"0"),a=(0,h.hE)(t.unborrowedLiquidity),o=B.Z.min(n,a),s=(0,h.hE)("0"),i=e.isInEmode&&e.userEmodeCategoryId===t.eModeCategoryId?t.formattedEModeLiquidationThreshold:t.formattedReserveLiquidationThreshold;if(null!==r&&void 0!==r&&r.usageAsCollateralEnabledOnUser&&"0"!==t.reserveLiquidationThreshold&&"0"!==e.totalBorrowsMarketReferenceCurrency){var u=(0,h.hE)(e.healthFactor).minus("1.01");u.gt("0")&&(s=u.multipliedBy(e.totalBorrowsMarketReferenceCurrency).div(i)),o=B.Z.min(o,s.dividedBy(t.formattedPriceInMarketReferenceCurrency))}return o},Z=t(50029),q=t(17674),F=t(87794),Y=t.n(F),G=t(75331),Q=t(24243),V=t(80854),z=t(85945),K=t(56371),X=t(89291),$=t(32113),J=t(39771),ee=t(31001),re=t(67489),te=t(85893);function ne(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function ae(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ne(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ne(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var oe=function(e){var r=e.amountToSwap,t=e.amountToReceive,n=e.isWrongNetwork,s=e.sx,i=e.poolReserve,c=e.targetReserve,l=e.isMaxSelected,d=e.loading,p=e.blocked,m=e.buildTxFn,f=(0,W.Y)((function(e){return[e.withdrawAndSwitch,e.currentMarketData,e.jsonRpcProvider,e.account,e.generateApproval,e.estimateGasLimit,e.walletApprovalMethodPreference,e.generateSignatureRequest,e.addTransaction,e.trackEvent]})),h=(0,q.Z)(f,10),v=h[0],y=h[1],x=h[2],g=h[3],b=h[4],A=h[5],T=h[6],w=h[7],O=h[8],S=h[9],j=(0,u.vR)(),I=j.approvalTxState,C=j.mainTxState,R=j.loadingTxns,D=j.setMainTxState,P=j.setTxError,M=j.setGasLimit,N=j.setLoadingTxns,H=j.setApprovalTxState,B=(0,E.Z)(),U=B.sendTx,F=B.signTxData,ne=(0,z.NL)(),oe=(0,o.useState)(void 0),se=oe[0],ie=oe[1],ue=(0,o.useState)(),ce=ue[0],le=ue[1],de=(0,o.useMemo)((function(){return void 0!==se&&-1!==se&&"0"!==r&&!n&&se<=Number(r)}),[se,r,n]),pe=T===$.n.PERMIT,me=function(){var e=(0,Z.Z)(Y().mark((function e(){var n,a,o,s,u;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,D(ae(ae({},C),{},{loading:!0})),e.next=4,m();case 4:return n=e.sent,a=v({poolReserve:i,targetReserve:c,isMaxSelected:l,amountToSwap:(0,K.parseUnits)(r,i.decimals).toString(),amountToReceive:(0,K.parseUnits)(t,c.decimals).toString(),augustus:n.augustus,txCalldata:n.swapCallData,signatureParams:ce}),e.next=8,A(a);case 8:return o=e.sent,e.next=11,U(o);case 11:return s=e.sent,e.next=14,s.wait(1);case 14:ne.invalidateQueries({queryKey:ee.B.pool}),ne.invalidateQueries({queryKey:ee.B.gho}),D({txHash:s.hash,loading:!1,success:!0}),O(s.hash,{action:G.UQ.withdrawAndSwitch,txState:"success",asset:i.underlyingAsset,amount:(0,K.parseUnits)(n.inputAmount,i.decimals).toString(),assetName:i.name,outAsset:c.underlyingAsset,outAssetName:c.name,outAmount:(0,K.parseUnits)(n.outputAmount,c.decimals).toString()}),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(0),u=(0,J.WG)(e.t0,J.aD.GAS_ESTIMATION,!1),P(u),D({txHash:void 0,loading:!1}),S(_.vh.TRANSACTION_ERROR,{transactiontype:G.UQ.withdrawAndSwitch,asset:i.underlyingAsset,assetName:i.name,error:e.t0});case 26:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=(0,Z.Z)(Y().mark((function e(){var t,n,a,o,s,u,c,l,d;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,k.sm)(r,i.decimals),n={user:g,token:i.aTokenAddress,spender:y.addresses.WITHDRAW_SWITCH_ADAPTER||"",amount:t},e.prev=2,!pe){e.next=16;break}return a=Math.floor(Date.now()/1e3+3600).toString(),e.next=7,w(ae(ae({},n),{},{deadline:a}));case 7:return o=e.sent,H(ae(ae({},I),{},{loading:!0})),e.next=11,F(o);case 11:s=e.sent,le({signature:s,deadline:a,amount:t}),H({txHash:X.Z,loading:!1,success:!0}),e.next=30;break;case 16:return u=b(n),e.next=19,A(u);case 19:return c=e.sent,H(ae(ae({},I),{},{loading:!0})),e.next=23,U(c);case 23:return l=e.sent,e.next=26,l.wait(1);case 26:H({txHash:l.hash,loading:!1,success:!0}),O(l.hash,{action:G.UQ.withdrawAndSwitch,txState:"success",asset:i.aTokenAddress,amount:(0,K.parseUnits)(t,i.decimals).toString(),assetName:"a".concat(i.symbol),spender:y.addresses.WITHDRAW_SWITCH_ADAPTER}),P(void 0),he(i.aTokenAddress);case 30:e.next=37;break;case 32:e.prev=32,e.t0=e.catch(2),d=(0,J.WG)(e.t0,J.aD.GAS_ESTIMATION,!1),P(d),I.success||H({txHash:void 0,loading:!1});case 37:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(){return e.apply(this,arguments)}}(),he=(0,o.useCallback)(function(){var e=(0,Z.Z)(Y().mark((function e(r){var t,n,a;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),t=x(),n=new Q.A(t),e.next=5,n.approvedAmount({user:g,token:r,spender:y.addresses.WITHDRAW_SWITCH_ADAPTER||""});case 5:a=e.sent,ie(a),N(!1);case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[x,g,y.addresses.WITHDRAW_SWITCH_ADAPTER,N]);return(0,o.useEffect)((function(){he(i.aTokenAddress)}),[he,i.aTokenAddress]),(0,o.useEffect)((function(){var e=0;e=Number(V.eB[G.UQ.withdrawAndSwitch].recommended),de&&!I.success&&(e+=Number(L.pQ)),M(e.toString())}),[de,I,M]),(0,te.jsx)(re.B,{mainTxState:C,approvalTxState:I,isWrongNetwork:n,preparingTransactions:R,handleAction:me,requiresAmount:!0,amount:r,handleApproval:function(){return fe()},requiresApproval:de,actionText:(0,te.jsx)(a.cC,{id:"Withdraw and Switch"}),actionInProgressText:(0,te.jsx)(a.cC,{id:"Withdrawing and Switching"}),sx:s,errorParams:{loading:!1,disabled:p||!(null!==I&&void 0!==I&&I.success),content:(0,te.jsx)(a.cC,{id:"Withdraw and Switch"}),handleClick:me},fetchingData:d,blocked:p,tryPermit:!0})},se=t(71335),ie=t(55200),ue=function(e){var r=e.txHash,t=e.amount,n=e.symbol,o=e.outAmount,s=e.outSymbol;return(0,te.jsx)(ie.R,{txHash:r,children:(0,te.jsxs)(y.Z,{sx:{mt:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[(0,te.jsx)(g.Z,{children:(0,te.jsx)(a.cC,{id:"You've successfully withdrew & switched tokens."})}),(0,te.jsxs)(y.Z,{sx:{display:"flex",alignItems:"center",gap:2,mt:3},children:[(0,te.jsx)(O.T1,{sx:{fontSize:"20px"},symbol:n}),(0,te.jsx)(w.B,{value:Number(t),compact:!0,variant:"main14"}),(0,te.jsx)(g.Z,{variant:"secondary14",children:n}),(0,te.jsx)(x.Z,{sx:{fontSize:"14px"},children:(0,te.jsx)(se.Z,{fontSize:"14px"})}),(0,te.jsx)(O.T1,{sx:{fontSize:"20px"},symbol:s}),(0,te.jsx)(w.B,{value:Number(o),variant:"main14"}),(0,te.jsx)(g.Z,{variant:"secondary14",children:s})]})]})})},ce=t(21046),le=t(28744),de=t(93591),pe=t(8430);function me(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function fe(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?me(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):me(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var he,ve=function(e){var r=e.poolReserve,t=e.amountToWithdraw,n=e.isWrongNetwork,s=e.tokenWrapperAddress,i=e.sx,c=e.blocked,l=(0,W.Y)((function(e){return[e.account,e.estimateGasLimit,e.walletApprovalMethodPreference,e.account,e.currentMarketData]})),d=(0,q.Z)(l,5),p=d[0],m=d[1],f=d[2],h=d[3],v=d[4],y=(0,E.Z)().sendTx,x=(0,z.NL)(),g=(0,o.useState)(),b=g[0],A=g[1],T=(0,u.vR)(),w=T.approvalTxState,O=T.mainTxState,S=T.loadingTxns,k=T.setLoadingTxns,j=T.setApprovalTxState,I=T.setMainTxState,C=T.setGasLimit,R=T.setTxError,D=(0,pe.z)().tokenWrapperService,_=(0,de.i)({marketData:v,token:r.aTokenAddress,spender:s}),P=_.data,M=_.isFetching,N=_.refetch;k(M);var H=!1;void 0!==P&&(H=(0,L.iv)({approvedAmount:P.toString(),amount:t,signedAmount:b?b.amount:"0"}));var B=f===$.n.PERMIT,U=(0,le.M)({usePermit:B,approvedAmount:{amount:(null===P||void 0===P?void 0:P.toString())||"0",spender:s,token:r.aTokenAddress,user:h},requiresApproval:H,assetAddress:r.aTokenAddress,symbol:r.symbol,decimals:r.decimals,signatureAmount:t,onApprovalTxConfirmed:N,onSignTxCompleted:function(e){return A(e)}}).approval,F=function(){var e=(0,Z.Z)(Y().mark((function e(){var n,a,o,i,u;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,I(fe(fe({},O),{},{loading:!0})),a="-1"===t?ce.Bz.toString():(0,V.gU)(t,r.decimals),!B||!b){e.next=17;break}return e.next=6,D.withdrawWrappedTokenWithPermit(a,s,h,b.deadline,b.signature);case 6:return o=e.sent,e.next=9,m(o);case 9:return o=e.sent,e.next=12,y(o);case 12:return n=e.sent,e.next=15,n.wait(1);case 15:e.next=28;break;case 17:return e.next=19,D.withdrawWrappedToken(a,s,p);case 19:return i=e.sent,e.next=22,m(i);case 22:return i=e.sent,e.next=25,y(i);case 25:return n=e.sent,e.next=28,n.wait(1);case 28:I({txHash:n.hash,loading:!1,success:!0}),x.invalidateQueries({queryKey:ee.B.pool}),x.invalidateQueries({queryKey:ee.B.approvedAmount(h,r.aTokenAddress,s,v)}),e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),u=(0,J.WG)(e.t0,J.aD.GAS_ESTIMATION,!1),R(u),j({txHash:void 0,loading:!1});case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){var e=0;e=Number(V.eB[G.UQ.withdraw].recommended),H&&!w.success&&(e+=Number(L.pQ)),C(e.toString())}),[H,w,B,C]),(0,te.jsx)(re.B,{blocked:c,preparingTransactions:S,approvalTxState:w,mainTxState:O,amount:t,isWrongNetwork:n,requiresAmount:!0,actionInProgressText:(0,te.jsx)(a.cC,{id:"Withdrawing"}),actionText:(0,te.jsx)(a.cC,{id:"Withdraw"}),handleAction:F,requiresApproval:H,handleApproval:U,sx:i,tryPermit:!0})};!function(e){e[e.CAN_NOT_WITHDRAW_THIS_AMOUNT=0]="CAN_NOT_WITHDRAW_THIS_AMOUNT",e[e.POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY=1]="POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY",e[e.ZERO_LTV_WITHDRAW_BLOCKED=2]="ZERO_LTV_WITHDRAW_BLOCKED"}(he||(he={}));var ye,xe=function(e){var r,t=e.assetsBlockingWithdraw,o=e.poolReserve,s=e.healthFactorAfterWithdraw,i=e.withdrawAmount,c=e.user,l=(0,u.vR)().mainTxState,d=void 0,p=(0,h.hE)(o.unborrowedLiquidity);l.success||l.txHash||(t.length>0&&!t.includes(o.symbol)?d=he.ZERO_LTV_WITHDRAW_BLOCKED:s.lt("1")&&"0"!==c.totalBorrowsMarketReferenceCurrency?d=he.CAN_NOT_WITHDRAW_THIS_AMOUNT:d||!p.eq("0")&&!(0,h.hE)(i).gt(o.unborrowedLiquidity)||(d=he.POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY));var m=(r={},(0,n.Z)(r,he.CAN_NOT_WITHDRAW_THIS_AMOUNT,(0,te.jsx)(a.cC,{id:"You can not withdraw this amount because it will cause collateral call"})),(0,n.Z)(r,he.POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY,(0,te.jsx)(a.cC,{id:"These funds have been borrowed and are not available for withdrawal at this time."})),(0,n.Z)(r,he.ZERO_LTV_WITHDRAW_BLOCKED,(0,te.jsx)(a.cC,{id:"Assets with zero LTV ({assetsBlockingWithdraw}) must be withdrawn or disabled as collateral to perform this action",values:{assetsBlockingWithdraw:t}})),r);return{blockingError:d,errorComponent:d?m[d]:null}};function ge(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function be(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ge(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ge(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}!function(e){e[e.CAN_NOT_WITHDRAW_THIS_AMOUNT=0]="CAN_NOT_WITHDRAW_THIS_AMOUNT",e[e.POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY=1]="POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY",e[e.ZERO_LTV_WITHDRAW_BLOCKED=2]="ZERO_LTV_WITHDRAW_BLOCKED"}(ye||(ye={}));var Ae,Te=function(e){var r=e.poolReserve,t=e.userReserve,n=e.symbol,s=e.isWrongNetwork,l=e.user,d=(0,u.vR)(),p=d.gasLimit,m=d.mainTxState,B=d.txError,Z=(0,E.Z)().currentAccount,q=(0,i.HT)().reserves,F=(0,c.f)(),Y=F.currentNetworkConfig,G=F.currentChainId,Q=(0,C.P)(),V=(0,o.useState)(""),z=V[0],K=V[1],X=(0,o.useState)(!1),$=X[0],J=X[1],ee=(0,o.useRef)(""),re=(0,W.Y)((function(e){return e.trackEvent})),ne=(0,o.useState)("0.1"),ae=ne[0],se=ne[1],ie=q.filter((function(e){return e.underlyingAsset!==r.underlyingAsset})).map((function(e){return{address:e.underlyingAsset,symbol:e.symbol,iconSymbol:e.iconSymbol}}));ie=[].concat((0,f.Z)(ie.filter((function(e){return"GHO"===e.symbol}))),(0,f.Z)(ie.filter((function(e){return"GHO"!==e.symbol}))));var ce=(0,o.useState)(ie[0]),le=ce[0],de=ce[1],pe="-1"===z,me=l.userReservesData.find((function(e){return e.underlyingAsset===le.address})),fe=U(l,t,r),he=(0,h.hE)((null===t||void 0===t?void 0:t.underlyingBalance)||"0"),ye=!1,ge=Q.find((function(e){return e.tokenOut.underlyingAsset===r.underlyingAsset}));ge&&(ye=le.address===ge.tokenIn.underlyingAsset);var Ae=(0,I.E)(ee.current,r.decimals,(null===ge||void 0===ge?void 0:ge.tokenWrapperAddress)||""),Te=Ae.data,we=Ae.isFetching,Oe=(0,j.k)({chainId:Y.underlyingChainId||G,userAddress:Z,swapIn:be(be({},r),{},{amount:ee.current}),swapOut:be(be({},me.reserve),{},{amount:"0"}),max:pe&&fe.eq(he),skip:ye||m.loading||!1,maxSlippage:Number(ae)}),Se=Oe.inputAmountUSD,ke=Oe.inputAmount,je=Oe.outputAmount,Ie=Oe.outputAmountUSD,Ce=Oe.error,Ee=Oe.loading,Re=Oe.buildTxFn,We=Ie;ye&&(We=(0,h.hE)(Te||"0").multipliedBy((null===ge||void 0===ge?void 0:ge.tokenIn.priceInUSD)||0).toString());var De=Ee&&"0"===Ie||ye&&we,_e=(0,h.hE)(r.unborrowedLiquidity),Pe=(0,L.Vc)(l),Me=pe?fe.toString(10):z,Ne=(0,D.DX)({user:l,userReserve:t,poolReserve:r,withdrawAmount:Me}),He=xe({assetsBlockingWithdraw:Pe,poolReserve:r,healthFactorAfterWithdraw:Ne,withdrawAmount:Me,user:l}),Le=He.blockingError,Be=He.errorComponent,Ue=Ne.toNumber()>=1&&Ne.toNumber()<1.5&&t.usageAsCollateralEnabledOnUser,Ze=(0,h.hE)(Me).multipliedBy((null===t||void 0===t?void 0:t.reserve.priceInUSD)||0),qe=(0,k.IG)(je,ae,me.reserve.decimals);if(m.success){var Fe=ke,Ye=qe;return ye&&(Fe=ee.current,Ye=Te||"0"),(0,te.jsx)(ue,{txHash:m.txHash,amount:Fe,symbol:r.isWrappedBaseAsset?Y.baseAssetSymbol:r.symbol,outSymbol:le.symbol,outAmount:Ye})}return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(M.W,{inputTitle:(0,te.jsx)(a.cC,{id:"Withdraw"}),value:Me,onChange:function(e){var t="-1"===e,n=(0,P.$w)(e,r.decimals);ee.current=t?fe.toString(10):n,K(n),t&&fe.eq(he)&&re(_.vh.MAX_INPUT_SELECTION,{type:"withdraw"})},symbol:n,assets:[{balance:fe.toString(10),symbol:n,iconSymbol:r.isWrappedBaseAsset?Y.baseAssetSymbol:r.iconSymbol}],usdValue:Ze.toString(10),isMaxSelected:pe,disabled:m.loading,maxValue:fe.toString(10),balanceText:_e.lt(he)?(0,te.jsx)(a.cC,{id:"Available"}):(0,te.jsx)(a.cC,{id:"Supply balance"})}),(0,te.jsxs)(y.Z,{sx:{padding:"18px",pt:"14px",display:"flex",justifyContent:"space-between"},children:[(0,te.jsx)(x.Z,{sx:{fontSize:"18px !important"},children:(0,te.jsx)(v.Z,{})}),(0,te.jsx)(T.B,{loading:De,outputAmountUSD:Ie,inputAmountUSD:Se})]}),(0,te.jsx)(M.W,{value:ye?Te||"":je,onSelect:de,usdValue:We,symbol:le.symbol,assets:ie,inputTitle:(0,te.jsx)(a.cC,{id:"Receive (est.)"}),balanceText:(0,te.jsx)(a.cC,{id:"Supply balance"}),disableInput:!0,loading:De}),Ce&&!De&&!ye&&(0,te.jsx)(g.Z,{variant:"helperText",color:"error.main",children:Ce}),void 0!==Le&&(0,te.jsx)(g.Z,{variant:"helperText",color:"error.main",children:Be}),(0,te.jsxs)(H.m6,{gasLimit:p,slippageSelector:ye?null:(0,te.jsx)(R.n,{selectedSlippage:ae,setSlippage:se,slippageTooltipHeader:(0,te.jsxs)(b.Z,{direction:"row",gap:2,alignItems:"center",justifyContent:"space-between",children:[(0,te.jsx)(a.cC,{id:"Minimum amount received"}),(0,te.jsx)(b.Z,{alignItems:"end",children:(0,te.jsxs)(b.Z,{direction:"row",children:[(0,te.jsx)(O.T1,{symbol:me.reserve.iconSymbol,sx:{mr:1,fontSize:"14px"}}),(0,te.jsx)(w.B,{value:qe,variant:"secondary12"})]})})]})}),children:[(0,te.jsx)(H.oD,{description:(0,te.jsx)(a.cC,{id:"Remaining supply"}),value:he.minus(Me||"0").toString(10),symbol:r.isWrappedBaseAsset?Y.baseAssetSymbol:r.symbol}),(0,te.jsx)(H.jz,{visibleHfChange:!!z,healthFactor:l?l.healthFactor:"-1",futureHealthFactor:Ne.toString(10)})]}),B&&(0,te.jsx)(N.Q,{txError:B}),Ue&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(S.v,{severity:"error",sx:{my:6},children:(0,te.jsx)(a.cC,{id:"Withdrawing this amount will reduce your health factor and increase risk of liquidation."})}),(0,te.jsxs)(y.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",mx:"24px",mb:"12px"},children:[(0,te.jsx)(A.Z,{checked:$,onChange:function(){J(!$),re(_.vh.ACCEPT_RISK,{modal:"Withdraw",riskCheckboxAccepted:$})},size:"small","data-cy":"risk-checkbox"}),(0,te.jsx)(g.Z,{variant:"description",children:(0,te.jsx)(a.cC,{id:"I acknowledge the risks involved."})})]})]}),ye?(0,te.jsx)(ve,{poolReserve:r,amountToWithdraw:ee.current,isWrongNetwork:s,tokenWrapperAddress:(null===ge||void 0===ge?void 0:ge.tokenWrapperAddress)||"",sx:Ue?{mt:0}:{},blocked:void 0!==Le||Ue&&!$}):(0,te.jsx)(oe,{poolReserve:r,targetReserve:me.reserve,amountToSwap:ke,amountToReceive:qe,isMaxSelected:pe&&fe.eq(he),isWrongNetwork:s,blocked:void 0!==Le||Ue&&!$,buildTxFn:Re,sx:Ue?{mt:0}:{}})]})},we=t(93608),Oe=function(e){var r=e.poolReserve,t=e.amountToWithdraw,n=e.poolAddress,o=e.isWrongNetwork,s=e.symbol,i=e.blocked,u=e.sx,c=(0,W.Y)((function(e){return e.withdraw})),l=(0,X.Q)({tryPermit:!1,handleGetTxns:function(){var e=(0,Z.Z)(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c({reserve:n,amount:t,aTokenAddress:r.aTokenAddress}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),skip:!t||0===parseFloat(t)||i,deps:[t,n],eventTxInfo:{amount:t,assetName:r.name,asset:r.underlyingAsset},protocolAction:G.UQ.withdraw}),d=l.action,p=l.loadingTxns,m=l.mainTxState,f=l.approvalTxState,h=l.approval,v=l.requiresApproval;return(0,te.jsx)(re.B,{blocked:i,preparingTransactions:p,approvalTxState:f,mainTxState:m,amount:t,isWrongNetwork:o,requiresAmount:!0,actionInProgressText:(0,te.jsx)(a.cC,{id:"Withdrawing {symbol}",values:{symbol:s}}),actionText:(0,te.jsx)(a.cC,{id:"Withdraw {symbol}",values:{symbol:s}}),handleAction:d,handleApproval:function(){return h([{amount:t,underlyingAsset:n}])},requiresApproval:v,sx:u})};!function(e){e[e.CAN_NOT_WITHDRAW_THIS_AMOUNT=0]="CAN_NOT_WITHDRAW_THIS_AMOUNT",e[e.POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY=1]="POOL_DOES_NOT_HAVE_ENOUGH_LIQUIDITY",e[e.ZERO_LTV_WITHDRAW_BLOCKED=2]="ZERO_LTV_WITHDRAW_BLOCKED"}(Ae||(Ae={}));var Se,ke=function(e){var r=e.poolReserve,t=e.userReserve,n=e.unwrap,s=e.setUnwrap,i=e.symbol,l=e.isWrongNetwork,d=e.user,p=(0,u.vR)(),m=p.gasLimit,f=p.mainTxState,v=p.txError,x=(0,c.f)().currentNetworkConfig,b=(0,o.useState)(""),T=b[0],w=b[1],O=(0,o.useState)(""),k=O[0],j=O[1],I=(0,o.useState)(!1),C=I[0],E=I[1],R=(0,o.useRef)(""),P=(0,W.Y)((function(e){return e.trackEvent})),B="-1"===T,Z=U(d,t,r),q=(0,h.hE)((null===t||void 0===t?void 0:t.underlyingBalance)||"0"),F=(0,h.hE)(r.unborrowedLiquidity),Y=B?Z.toString(10):T,G=(0,L.Vc)(d),Q=(0,D.DX)({user:d,userReserve:t,poolReserve:r,withdrawAmount:Y}),z=xe({assetsBlockingWithdraw:G,poolReserve:r,healthFactorAfterWithdraw:Q,withdrawAmount:Y,user:d}),K=z.blockingError,X=z.errorComponent,$=Q.toNumber()>=1&&Q.toNumber()<1.5&&t.usageAsCollateralEnabledOnUser,J=(0,h.hE)(Y).multipliedBy((null===t||void 0===t?void 0:t.reserve.priceInUSD)||0);return f.success?(0,te.jsx)(we.R,{action:(0,te.jsx)(a.cC,{id:"withdrew"}),amount:R.current,symbol:n&&r.isWrappedBaseAsset?x.baseAssetSymbol:r.symbol}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(M.W,{value:Y,onChange:function(e){var r="-1"===e;R.current=r?Z.toString(10):e,w(e),r&&Z.eq(q)?(P(_.vh.MAX_INPUT_SELECTION,{type:"withdraw"}),j("-1")):j(Z.toString(10))},symbol:i,assets:[{balance:Z.toString(10),symbol:i,iconSymbol:n&&r.isWrappedBaseAsset?x.baseAssetSymbol:r.iconSymbol}],usdValue:J.toString(10),isMaxSelected:B,disabled:f.loading,maxValue:Z.toString(10),balanceText:F.lt(q)?(0,te.jsx)(a.cC,{id:"Available"}):(0,te.jsx)(a.cC,{id:"Supply balance"})}),void 0!==K&&(0,te.jsx)(g.Z,{variant:"helperText",color:"error.main",children:X}),r.isWrappedBaseAsset&&(0,te.jsx)(H.Pu,{unwrapped:n,setUnWrapped:s,label:(0,te.jsx)(g.Z,{children:"Unwrap ".concat(r.symbol," (to withdraw ").concat(x.baseAssetSymbol,")")})}),(0,te.jsxs)(H.m6,{gasLimit:m,children:[(0,te.jsx)(H.oD,{description:(0,te.jsx)(a.cC,{id:"Remaining supply"}),value:q.minus(Y||"0").toString(10),symbol:r.isWrappedBaseAsset?x.baseAssetSymbol:r.symbol}),(0,te.jsx)(H.jz,{visibleHfChange:!!T,healthFactor:d?d.healthFactor:"-1",futureHealthFactor:Q.toString(10)})]}),v&&(0,te.jsx)(N.Q,{txError:v}),$&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(S.v,{severity:"error",sx:{my:6},children:(0,te.jsx)(a.cC,{id:"Withdrawing this amount will reduce your health factor and increase risk of liquidation."})}),(0,te.jsxs)(y.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",mx:"24px",mb:"12px"},children:[(0,te.jsx)(A.Z,{checked:C,onChange:function(){E(!C),P(_.vh.ACCEPT_RISK,{modal:"Withdraw",riskCheckboxAccepted:C})},size:"small","data-cy":"risk-checkbox"}),(0,te.jsx)(g.Z,{variant:"description",children:(0,te.jsx)(a.cC,{id:"I acknowledge the risks involved."})})]})]}),(0,te.jsx)(Oe,{poolReserve:r,amountToWithdraw:B?k:Y,poolAddress:n&&r.isWrappedBaseAsset?V.hP:r.underlyingAsset,isWrongNetwork:l,symbol:i,blocked:void 0!==K||$&&!C,sx:$?{mt:0}:{}})]})},je=t(34637),Ie=t(59379);function Ce(e){var r,t=e.withdrawType,n=e.setWithdrawType,o=(0,c.f)().currentMarketData,s=(0,W.Y)((function(e){return e.trackEvent}));return null!==(r=o.enabledFeatures)&&void 0!==r&&r.collateralRepay?(0,te.jsx)(y.Z,{sx:{mb:6},children:(0,te.jsxs)(Ie.f,{color:"primary",value:t,exclusive:!0,onChange:function(e,r){return n(r)},children:[(0,te.jsx)(je.Y,{value:Se.WITHDRAW,disabled:t===Se.WITHDRAW,onClick:function(){return s(_.sj.SWITCH_WITHDRAW_TYPE,{withdrawType:"Withdraw"})},children:(0,te.jsx)(g.Z,{variant:"buttonM",children:(0,te.jsx)(a.cC,{id:"Withdraw"})})}),(0,te.jsx)(je.Y,{value:Se.WITHDRAWSWITCH,disabled:t===Se.WITHDRAWSWITCH,onClick:function(){return s(_.sj.SWITCH_WITHDRAW_TYPE,{withdrawType:"Withdraw and Switch"})},children:(0,te.jsx)(g.Z,{variant:"buttonM",children:(0,te.jsx)(a.cC,{id:"Withdraw & Switch"})})})]})}):null}function Ee(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Re(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Ee(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ee(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}!function(e){e[e.WITHDRAW=0]="WITHDRAW",e[e.WITHDRAWSWITCH=1]="WITHDRAWSWITCH"}(Se||(Se={}));var We=function(){var e=(0,u.vR)(),r=e.type,t=e.close,n=e.args,f=e.mainTxState,h=(0,o.useState)(!0),v=h[0],y=h[1],x=(0,o.useState)(Se.WITHDRAW),g=x[0],b=x[1],A=(0,c.f)().currentMarketData,T=(0,i.HT)().reserves,w=(0,l.hN)(T),O=d.cr.withdrawAndSwitch(A)&&n.underlyingAsset!==(null===w||void 0===w?void 0:w.underlyingAsset);return(0,te.jsx)(p.P,{open:r===u.w8.Withdraw,setOpen:function(){b(Se.WITHDRAW),t()},children:(0,te.jsx)(m.A,{title:(0,te.jsx)(a.cC,{id:"Withdraw"}),underlyingAsset:n.underlyingAsset,keepWrappedSymbol:!v,children:function(e){return(0,te.jsx)(s.X,{children:function(r){return(0,te.jsxs)(te.Fragment,{children:[O&&!f.txHash&&(0,te.jsx)(Ce,{withdrawType:g,setWithdrawType:b}),g===Se.WITHDRAW&&(0,te.jsx)(ke,Re(Re({},e),{},{unwrap:v,setUnwrap:y,user:r})),g===Se.WITHDRAWSWITCH&&(0,te.jsx)(te.Fragment,{children:(0,te.jsx)(Te,Re(Re({},e),{},{user:r}))})]})}})}})})}},30313:function(e,r,t){t.d(r,{k:function(){return c}});var n=t(50029),a=t(87794),o=t.n(a),s=t(1279),i=t(67294),u=t(74119),c=function(e){var r=e.chainId,t=e.max,a=e.maxSlippage,c=e.swapIn,l=e.swapOut,d=e.userAddress,p=e.skip,m=(0,i.useState)("0"),f=m[0],h=m[1],v=(0,i.useState)("0"),y=v[0],x=v[1],g=(0,i.useState)("0"),b=g[0],A=g[1],T=(0,i.useState)("0"),w=T[0],O=T[1],S=(0,i.useState)(),k=S[0],j=S[1],I=(0,i.useState)(!1),C=I[0],E=I[1],R=(0,i.useState)(""),W=R[0],D=R[1],_=(0,i.useMemo)((function(){return{underlyingAsset:c.underlyingAsset,decimals:c.decimals,supplyAPY:c.supplyAPY,amount:c.amount,variableBorrowAPY:c.variableBorrowAPY}}),[c.amount,c.decimals,c.supplyAPY,c.underlyingAsset,c.variableBorrowAPY]),P=(0,i.useMemo)((function(){return{underlyingAsset:l.underlyingAsset,decimals:l.decimals,supplyAPY:l.supplyAPY,amount:l.amount,variableBorrowAPY:l.variableBorrowAPY}}),[l.amount,l.decimals,l.supplyAPY,l.underlyingAsset,l.variableBorrowAPY]),M=(0,i.useCallback)((function(){return(0,u.F8)(_,P,r,d,t)}),[r,_,P,d,t]);return(0,i.useEffect)((function(){if(!p){var e=function(){var e=(0,n.Z)(o().mark((function e(){var r,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.underlyingAsset&&P.underlyingAsset&&_.amount&&"0"!==_.amount&&!isNaN(+_.amount)){e.next=7;break}return h("0"),A("0"),O("0"),x("0"),j(void 0),e.abrupt("return");case 7:return E(!0),e.prev=8,e.next=11,M();case 11:r=e.sent,D(""),j(r),h((0,s.Fv)(r.srcAmount,r.srcDecimals)),x(r.srcUSD),A((0,s.Fv)(r.destAmount,r.destDecimals)),O(r.destUSD),e.next=25;break;case 20:e.prev=20,e.t0=e.catch(8),console.error(e.t0),t=(0,u.aE)(e.t0.message),D(t);case 25:return e.prev=25,E(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[8,20,25,28]])})));return function(){return e.apply(this,arguments)}}(),r=setTimeout((function(){e()}),400);return function(){clearTimeout(r)}}}),[W,p,_.underlyingAsset,P.underlyingAsset,M,a,_.amount,d,t]),{outputAmount:b,outputAmountUSD:w,inputAmount:f,inputAmountUSD:y,loading:C,error:W,buildTxFn:function(){var e=(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=2;break}throw new Error("Route required to build transaction");case 2:return e.abrupt("return",(0,u.xS)(k,c,l,r,d,a));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}},39051:function(e,r,t){t.d(r,{E:function(){return i},v:function(){return u}});var n=t(36492),a=t(2593),o=t(56371),s=t(8430),i=function(e,r,t){var i=(0,s.z)().tokenWrapperService;return(0,n.a)({queryFn:function(){return""===e||"0"===e?Promise.resolve(a.O$.from(0)):i.getTokenInForTokenOut((0,o.parseUnits)(e,r).toString(),t)},queryKey:["tokenInForTokenOut",t,e],select:function(e){return(0,o.formatUnits)(e.toString(),r)}})},u=function(e,r,t){var i=(0,s.z)().tokenWrapperService;return(0,n.a)({queryFn:function(){return""===e||"0"===e?Promise.resolve(a.O$.from(0)):i.getTokenOutForTokenIn((0,o.parseUnits)(e,r).toString(),t)},queryKey:["tokenOutForTokenIn",t,e],select:function(e){return(0,o.formatUnits)(e.toString(),r)}})}},28744:function(e,r,t){t.d(r,{M:function(){return g}});var n=t(59499),a=t(50029),o=t(17674),s=t(87794),i=t.n(s),u=t(75331),c=t(80854),l=t(21046),d=t(56371),p=t(89291),m=t(77537),f=t(78371),h=t(39771),v=t(8195);function y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?y(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var g=function(e){var r=e.usePermit,t=e.approvedAmount,n=e.requiresApproval,s=e.assetAddress,y=e.symbol,g=e.decimals,b=e.signatureAmount,A=e.onApprovalTxConfirmed,T=e.onSignTxCompleted,w=(0,f.Y)((function(e){return[e.generateApproval,e.generateSignatureRequest,e.estimateGasLimit,e.addTransaction]})),O=(0,o.Z)(w,4),S=O[0],k=O[1],j=O[2],I=O[3],C=(0,m.Z)(),E=C.signTxData,R=C.sendTx,W=(0,v.vR)(),D=W.approvalTxState,_=W.setApprovalTxState,P=W.setTxError,M=function(){var e=(0,a.Z)(i().mark((function e(){var a,o,m,f,v,w;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n||!t){e.next=30;break}if(!r){e.next=16;break}return _(x(x({},D),{},{loading:!0})),a=Math.floor(Date.now()/1e3+3600).toString(),e.next=7,k(x(x({},t),{},{deadline:a,amount:"-1"===b?l.Bz.toString():(0,d.parseUnits)(b,g).toString()}));case 7:return o=e.sent,e.next=10,E(o);case 10:m=e.sent,T&&T({signature:m,deadline:a,amount:b}),P(void 0),_({txHash:p.Z,loading:!1,success:!0}),e.next=30;break;case 16:return f=S(t),_(x(x({},D),{},{loading:!0})),e.next=20,j(f);case 20:return f=e.sent,e.next=23,R(f);case 23:return v=e.sent,e.next=26,v.wait(1);case 26:_({txHash:v.hash,loading:!1,success:!0